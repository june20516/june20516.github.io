<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="/_next/static/css/9674fbd74573baf2.css" data-precedence="next" />
    <link rel="stylesheet" href="/_next/static/css/6e7101011807f3ed.css" data-precedence="next" />
    <link
      rel="preload"
      as="script"
      href="https://www.googletagmanager.com/gtag/js?id=G-Q587R5F0YL"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any" />
    <script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" nomodule=""></script></head
  ><style data-emotion="css-global n68zyo">
    :root {
      --mui-palette-primary-main: #b782f4;
      --mui-palette-secondary-main: #ef89e1;
      --mui-palette-info-main: #5158d9;
      --mui-palette-error-main: #ea3786;
      --mui-palette-background-default: #080046;
      --mui-palette-action-active: #f4a261;
      --mui-palette-action-disabled: #1e299e;
      --mui-palette-text-primary: #b782f4;
      --mui-palette-text-secondary: #ef89e1;
      --mui-palette-text-disabled: #1e299e;
      --mui-palette-divider: #5158d9;
      --mui-typography-fontFamily: Pretendard, Arial, sans-serif;
    }</style
  ><style data-emotion="css 1etbwff">
    .css-1etbwff {
      height: 100vh;
      display: -webkit-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      -webkit-flex-direction: column;
      -ms-flex-direction: column;
      flex-direction: column;
      background-color: #080046;
    }
  </style>
  <body class="MuiBox-root css-1etbwff">
    <style data-emotion="css 1rl0808">
      .css-1rl0808 {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        -webkit-align-items: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        height: 10%;
      }
    </style>
    <header class="MuiBox-root css-1rl0808">
      <a href="/"
        ><style data-emotion="css rvp98e">
          .css-rvp98e {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-align-items: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            gap: 1rem;
          }
        </style>
        <div class="MuiBox-root css-rvp98e">
          <style data-emotion="css 7us9jm">
            .css-7us9jm {
              position: relative;
              aspect-ratio: 1;
              width: 2.5rem;
            }
          </style>
          <div class="MuiBox-root css-7us9jm">
            <img
              alt="icon of codeverse"
              loading="lazy"
              decoding="async"
              data-nimg="fill"
              style="
                position: absolute;
                height: 100%;
                width: 100%;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                color: transparent;
              "
              src="/assets/images/codeverse_icon.png"
            />
          </div>
          <style data-emotion="css y3clwh">
            .css-y3clwh {
              margin: 0;
              font-size: 2rem;
              font-weight: bold;
              font-family: Pretendard, Arial, sans-serif;
              line-height: 1.167;
              color: #b782f4;
            }
          </style>
          <h1 class="MuiTypography-root MuiTypography-h1 css-y3clwh">Codeverse</h1>
        </div></a
      >
    </header>
    <style data-emotion="css ysfit3">
      .css-ysfit3 {
        height: 90%;
        width: 900px;
        margin-left: auto;
        margin-right: auto;
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        -webkit-flex-direction: column;
        -ms-flex-direction: column;
        flex-direction: column;
      }
    </style>
    <main class="MuiBox-root css-ysfit3">
      <style data-emotion="css 1hcqf0i">
        .css-1hcqf0i {
          -webkit-align-self: center;
          -ms-flex-item-align: center;
          align-self: center;
          width: 100%;
        }
      </style>
      <nav class="MuiBox-root css-1hcqf0i">
        <style data-emotion="css 17nvzqb">
          .css-17nvzqb {
            list-style: none;
            margin: 0;
            padding: 0;
            position: relative;
            padding-top: 8px;
            padding-bottom: 8px;
            padding-left: 40px;
            padding-right: 40px;
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: space-around;
            -ms-flex-pack: space-around;
            -webkit-justify-content: space-around;
            justify-content: space-around;
          }
        </style>
        <ul class="MuiList-root MuiList-padding css-17nvzqb">
          <a href="/posts"
            ><style data-emotion="css kkkt2y">
              .css-kkkt2y {
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                -webkit-box-pack: start;
                -ms-flex-pack: start;
                -webkit-justify-content: flex-start;
                justify-content: flex-start;
                -webkit-align-items: center;
                -webkit-box-align: center;
                -ms-flex-align: center;
                align-items: center;
                position: relative;
                -webkit-text-decoration: none;
                text-decoration: none;
                width: 100%;
                box-sizing: border-box;
                text-align: left;
                padding-top: 8px;
                padding-bottom: 8px;
                padding-left: 16px;
                padding-right: 16px;
                width: 100%;
                height: 100%;
              }
            </style>
            <li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-kkkt2y">
              <style data-emotion="css inuf4m">
                .css-inuf4m {
                  margin: 0;
                  font-size: 1.25rem;
                  font-weight: bold;
                  font-family: Pretendard, Arial, sans-serif;
                  line-height: 1.75;
                  color: #b782f4;
                }
              </style>
              <h6 class="MuiTypography-root MuiTypography-subtitle1 css-inuf4m">Posts</h6>
            </li></a
          ><a href="/tags"
            ><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-kkkt2y">
              <h6 class="MuiTypography-root MuiTypography-subtitle1 css-inuf4m">Tags</h6>
            </li></a
          ><a href="/about"
            ><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-kkkt2y">
              <h6 class="MuiTypography-root MuiTypography-subtitle1 css-inuf4m">About Me</h6>
            </li></a
          >
        </ul>
      </nav>
      <style data-emotion="css kok1lf">
        .css-kok1lf {
          overflow: scroll;
          -ms-overflow-style: none;
        }
        .css-kok1lf::-webkit-scrollbar {
          display: none;
        }
      </style>
      <section class="MuiBox-root css-kok1lf">
        <div>
          <style data-emotion="css 79elbk">
            .css-79elbk {
              position: relative;
            }
          </style>
          <article class="MuiBox-root css-79elbk">
            <style data-emotion="css 1yn3bhb">
              .css-1yn3bhb {
                font-weight: 700;
                text-align: center;
                padding: 40px;
                max-height: 24rem;
                min-height: -webkit-fit-content;
                min-height: -moz-fit-content;
                min-height: fit-content;
                -webkit-transition: all 0.3s;
                transition: all 0.3s;
                position: relative;
              }
            </style>
            <div class="MuiBox-root css-1yn3bhb">
              <h6 class="MuiTypography-root MuiTypography-subtitle1 css-inuf4m">
                AWS RDS의 Data base를 dump하기
              </h6>
              <style data-emotion="css d6vcym">
                .css-d6vcym {
                  margin: 0;
                  font-size: 0.875rem;
                  font-family: Pretendard, Arial, sans-serif;
                  font-weight: 400;
                  line-height: 1.43;
                  color: #ef89e1;
                  text-align: right;
                  font-style: italic;
                }
              </style>
              <p class="MuiTypography-root MuiTypography-body2 css-d6vcym">
                -
                <!-- -->2021/09/14
              </p>
            </div>
            <style data-emotion="css lv7w6x">
              .css-lv7w6x {
                box-sizing: border-box;
                width: 100%;
                padding: 32px;
              }
            </style>
            <div class="MuiBox-root css-lv7w6x">
              <style data-emotion="css 158e1jz">
                .css-158e1jz {
                  margin: 0;
                  font-size: 1rem;
                  font-family: Pretendard, Arial, sans-serif;
                  font-weight: 400;
                  line-height: 1.5;
                  color: #5158d9;
                }
              </style>
              <p class="MuiTypography-root MuiTypography-body1 css-158e1jz">
                <style data-emotion="css 10vyf6v">
                  .css-10vyf6v {
                    -webkit-user-select: none;
                    -moz-user-select: none;
                    -ms-user-select: none;
                    user-select: none;
                    width: 1em;
                    height: 1em;
                    display: inline-block;
                    -webkit-flex-shrink: 0;
                    -ms-flex-negative: 0;
                    flex-shrink: 0;
                    -webkit-transition: fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
                    transition: fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
                    fill: currentColor;
                    font-size: 1.5rem;
                  }</style
                ><svg
                  class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-10vyf6v"
                  focusable="false"
                  aria-hidden="true"
                  viewBox="0 0 24 24"
                  data-testid="FormatQuoteIcon"
                >
                  <path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"></path></svg
                >VPC 내부에 있는 RDS에서 데이터베이스를 덤프하고, 이를 로컬 MySQL로 복구하는
                과정에서 겪은 문제들을 기록한다.
              </p>
            </div>
            <style data-emotion="css 1b3tymb">
              .css-1b3tymb {
                width: 90%;
                margin: auto;
                display: block;
              }</style
            ><img
              class="MuiBox-root css-1b3tymb"
              src="/assets/images/posts/rds-dump.png"
              alt="thumbnail"
              loading="lazy"
            /><style data-emotion="css 1qm1lh">
              .css-1qm1lh {
                margin-bottom: 16px;
              }
            </style>
            <div class="markdown-body post MuiBox-root css-1qm1lh">
              <h2 id="ssh-tunneling을-통해-db-dump해오기" class="heading">
                ssh tunneling을 통해 DB dump해오기
              </h2>
              <ul>
                <li>mysqldump 명령어를 사용하여 .sql 파일 형태로 데이터베이스를 덤프할 수 있다.</li>
                <li>
                  이 과정에서는 터널링을 수행할 EC2 인스턴스에 MySQL 클라이언트가 설치되어 있어야
                  한다.
                </li>
              </ul>
              <pre
                class="language-shell"
              ><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">ssh</span> <span class="token variable"><span class="token variable">`</span>tunneling-instanse-username<span class="token variable">`</span></span>@<span class="token variable"><span class="token variable">`</span>tunneling-instanse-host<span class="token variable">`</span></span> <span class="token parameter variable">-i</span> <span class="token variable"><span class="token variable">`</span>key-file-path<span class="token variable">`</span></span> mysqldump -u<span class="token variable"><span class="token variable">`</span>username<span class="token variable">`</span></span> -p<span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span> <span class="token parameter variable">-h</span> <span class="token variable"><span class="token variable">`</span>remote-db-host<span class="token variable">`</span></span> <span class="token variable"><span class="token variable">`</span>database-name<span class="token variable">`</span></span> <span class="token operator">></span> <span class="token variable"><span class="token variable">`</span>local/path/to/save.sql<span class="token variable">`</span></span>
</span></code></pre>
              <h3 id="column_statistics">COLUMN_STATISTICS</h3>
              <h4
                id="덤프-시도-중--unknown-table-column_statistics-in-information_schema-라는-에러가-발생할-경우"
              >
                덤프 시도 중
                <code>...: Unknown table 'COLUMN_STATISTICS' in information_schema</code> 라는
                에러가 발생할 경우
              </h4>
              <ul>
                <li>
                  이 에러는 MySQL 8.0에서 새로 추가된 옵션인 COLUMN_STATISTICS 때문이다. 이 옵션은
                  테이블의 통계 데이터를 분석하여 덤프 시 포함하는 기능이다.
                  <sup
                    ><a
                      href="https://jay-ji.tistory.com/62"
                      target="_blank"
                      rel="noopener noreferer"
                      >레퍼런스</a
                    ></sup
                  >
                </li>
                <li>
                  이 옵션을 비활성화하려면 덤프 명령어에 <code>--column-statistics=0</code>을
                  추가한다.
                </li>
              </ul>
              <pre
                class="language-shell"
              ><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">ssh</span> <span class="token variable"><span class="token variable">`</span>tunneling-instanse-username<span class="token variable">`</span></span>@<span class="token variable"><span class="token variable">`</span>tunneling-instanse-host<span class="token variable">`</span></span> <span class="token parameter variable">-i</span> <span class="token variable"><span class="token variable">`</span>key-file-path<span class="token variable">`</span></span> mysqldump -u<span class="token variable"><span class="token variable">`</span>username<span class="token variable">`</span></span> -p<span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span> <span class="token parameter variable">-h</span> <span class="token variable"><span class="token variable">`</span>remote-db-host<span class="token variable">`</span></span> --column-statistics<span class="token operator">=</span><span class="token number">0</span> <span class="token variable"><span class="token variable">`</span>database-name<span class="token variable">`</span></span> <span class="token operator">></span> <span class="token variable"><span class="token variable">`</span>local/path/to/save.sql<span class="token variable">`</span></span>
</span></code></pre>
              <h4 id="덤프-시도-중-unknown-variable-column-statistics0-라는-에러가-발생할-경우">
                덤프 시도 중 <code>...unknown variable 'column-statistics=0'...</code> 라는 에러가
                발생할 경우
              </h4>
              <ul>
                <li>
                  이 에러는 해당 옵션이 불필요한 경우 발생할 수 있다. 이런 경우에는 덤프 명령어에서
                  <code>--column-statistics=0</code>을 제거하고 다시 시도한다.
                </li>
              </ul>
              <h2 id="sql파일을-로컬-mysql에-로드하기" class="heading">
                .sql파일을 로컬 mysql에 로드하기
              </h2>
              <ul>
                <li>덤프한 .sql 파일을 로컬 데이터베이스에 로드할 때는 mysql 명령어를 사용한다.</li>
                <li>데이터를 받을 데이터베이스는 미리 생성되어 있고 비어 있어야 한다.</li>
              </ul>
              <pre
                class="language-shell"
              ><code class="language-shell code-highlight"><span class="code-line">$ mysql -u<span class="token variable"><span class="token variable">`</span>local-user-name<span class="token variable">`</span></span> -p<span class="token variable"><span class="token variable">`</span>local-pwd<span class="token variable">`</span></span> <span class="token variable"><span class="token variable">`</span>database-name<span class="token variable">`</span></span> <span class="token operator">&#x3C;</span> <span class="token variable"><span class="token variable">`</span>path/for/dumped.sql<span class="token variable">`</span></span>
</span></code></pre>
              <h3 id="no_auto_create_user">NO_AUTO_CREATE_USER</h3>
              <h4
                id="로드-시도-중-variable-sql_mode-cant-be-set-to-the-value-of-no_auto_create_user-라는-에러가-발생할-경우"
              >
                로드 시도 중
                <code>Variable 'sql_mode' can't be set to the value of 'NO_AUTO_CREATE_USER'</code>
                라는 에러가 발생할 경우
              </h4>
              <ul>
                <li>
                  이 에러는 MySQL 8.0 이상 버전에서 발생하는데, 해당 모드는 사용자 생성 관련 모드다.
                  MySQL 8.0 이상에서는 이 모드가 제거되었으며, 대신 <code>CREATE USER</code> 또는
                  <code>GRANT</code> 구문을 사용한다.
                </li>
                <li>이 문제를 해결하려면 <code>dumped.sql</code> 파일을 수정해야 한다.</li>
                <li>
                  .sql 파일은 매우 크기 때문에 일반 텍스트 에디터로 수정하는 것은 비효율적이다. 대신
                  <code>sed</code> 명령어를 사용해 빠르게 수정할 수 있다.
                </li>
                <li>
                  <code>macOS</code>와 같은 <code>Unix</code> 계열 시스템에서는 다음과 같이
                  <code>sed</code> 명령어를 사용한다.
                </li>
              </ul>
              <pre
                class="language-shell"
              ><code class="language-shell code-highlight"><span class="code-line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">''</span> <span class="token string">'s/NO_AUTO_CREATE_USER//'</span> <span class="token variable"><span class="token variable">`</span>path/for/dumped.sql<span class="token variable">`</span></span>
</span></code></pre>
              <ul>
                <li>수정한 후 다시 데이터를 로드하면 된다.</li>
              </ul>
            </div>
          </article>
        </div>
      </section>
    </main>
    <!--$!--><template data-dgst="NEXT_DYNAMIC_NO_SSR_CODE"></template
    ><!--/$-->
    <script src="/_next/static/chunks/webpack-315f2c03e4148e38.js" async=""></script>
    <script src="/_next/static/chunks/2443530c-b37977cb0d35fe50.js" async=""></script>
    <script src="/_next/static/chunks/488-754b8491efac4835.js" async=""></script>
    <script src="/_next/static/chunks/main-app-98d28d7655df5891.js" async=""></script>
    <script>
      (self.__next_f = self.__next_f || []).push([0]);
    </script>
    <script>
      self.__next_f.push([
        1,
        '1:HL["/_next/static/css/9674fbd74573baf2.css",{"as":"style"}]\n0:"$L2"\n',
      ]);
    </script>
    <script>
      self.__next_f.push([1, '3:HL["/_next/static/css/6e7101011807f3ed.css",{"as":"style"}]\n']);
    </script>
    <script>
      self.__next_f.push([
        1,
        '4:I{"id":"8827","chunks":["272:static/chunks/webpack-315f2c03e4148e38.js","667:static/chunks/2443530c-b37977cb0d35fe50.js","488:static/chunks/488-754b8491efac4835.js"],"name":"","async":false}\n6:I{"id":"9126","chunks":["272:static/chunks/webpack-315f2c03e4148e38.js","667:static/chunks/2443530c-b37977cb0d35fe50.js","488:static/chunks/488-754b8491efac4835.js"],"name":"","async":false}\n7:I{"id":"6698","chunks":["771:static/chunks/771-1fb5f02affb54e80.js","274:static/chunks/274-31a5843dc341abd2.js","964:static/',
      ]);
    </script>
    <script>
      self.__next_f.push([
        1,
        'chunks/964-3fbb84800944960d.js","925:static/chunks/925-98b9640d621f887a.js","222:static/chunks/222-8be30348cbe4dffe.js","185:static/chunks/app/layout-bf724705ac814d31.js"],"name":"","async":false}\n9:I{"id":"4463","chunks":["272:static/chunks/webpack-315f2c03e4148e38.js","667:static/chunks/2443530c-b37977cb0d35fe50.js","488:static/chunks/488-754b8491efac4835.js"],"name":"","async":false}\na:I{"id":"1010","chunks":["272:static/chunks/webpack-315f2c03e4148e38.js","667:static/chunks/2443530c-b37977cb0d35fe50.js"',
      ]);
    </script>
    <script>
      self.__next_f.push([
        1,
        ',"488:static/chunks/488-754b8491efac4835.js"],"name":"","async":false}\n',
      ]);
    </script>
    <script>
      self.__next_f.push([
        1,
        '2:[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/9674fbd74573baf2.css","precedence":"next"}]],["$","$L4",null,{"assetPrefix":"","initialCanonicalUrl":"/posts/rds-dump","initialTree":["",{"children":["posts",{"children":[["slug","rds-dump","d"],{"children":["__PAGE__?{\\"slug\\":\\"rds-dump\\"}",{}]}]}]},"$undefined","$undefined",true],"initialHead":["$L5",null],"globalErrorComponent":"$6","notFound":["$","$L7",null,{"params":{},"children":["$L8","$undefined",[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\\"Segoe UI\\",Roboto,Helvetica,Arial,sans-serif,\\"Apple Color Emoji\\",\\"Segoe UI Emoji\\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]]}],"asNotFound":false,"children":[["$","$L7",null,{"children":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[[null,["$","div",null,{"children":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["slug","rds-dump","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lb",null],"segment":"__PAGE__?{\\"slug\\":\\"rds-dump\\"}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/6e7101011807f3ed.css","precedence":"next"}]]}]}]],null],"segment":["slug","rds-dump","d"]},"styles":[]}],"segment":"posts"},"styles":[]}],"params":{}}],null]}]]\n',
      ]);
    </script>
    <script>
      self.__next_f.push([
        1,
        'c:I{"id":"3677","chunks":["771:static/chunks/771-1fb5f02affb54e80.js","964:static/chunks/964-3fbb84800944960d.js","333:static/chunks/app/posts/[slug]/page-696bec97c8d42b27.js"],"name":"","async":false}\n',
      ]);
    </script>
    <script>
      self.__next_f.push([
        1,
        'b:[null,["$","$Lc",null,{"post":{"slug":"rds-dump","meta":{"title":"AWS RDS의 Data base를 dump하기","description":"VPC 내부에 있는 RDS에서 데이터베이스를 덤프하고, 이를 로컬 MySQL로 복구하는 과정에서 겪은 문제들을 기록한다.","date":"2021/09/14","tags":["COLUMN_STATISTICS","NO_AUTO_CREATE_USER","column-statistics=0","mysqldump","sed","sql_mode","ssh tunneling"],"thumbnail":"assets/images/posts/rds-dump.png"},"content":"\\n## ssh tunneling을 통해 DB dump해오기\\n\\n- mysqldump 명령어를 사용하여 .sql 파일 형태로 데이터베이스를 덤프할 수 있다.\\n- 이 과정에서는 터널링을 수행할 EC2 인스턴스에 MySQL 클라이언트가 설치되어 있어야 한다.\\n\\n```shell\\n$ ssh `tunneling-instanse-username`@`tunneling-instanse-host` -i `key-file-path` mysqldump -u`username` -p`password` -h `remote-db-host` `database-name` \u003e `local/path/to/save.sql`\\n```\\n\\n### COLUMN_STATISTICS\\n\\n#### 덤프 시도 중 `...: Unknown table \'COLUMN_STATISTICS\' in information_schema` 라는 에러가 발생할 경우\\n\\n- 이 에러는 MySQL 8.0에서 새로 추가된 옵션인 COLUMN_STATISTICS 때문이다. 이 옵션은 테이블의 통계 데이터를 분석하여 덤프 시 포함하는 기능이다. \u003csup\u003e[레퍼런스](https://jay-ji.tistory.com/62)\u003c/sup\u003e\\n- 이 옵션을 비활성화하려면 덤프 명령어에 `--column-statistics=0`을 추가한다.\\n\\n```shell\\n$ ssh `tunneling-instanse-username`@`tunneling-instanse-host` -i `key-file-path` mysqldump -u`username` -p`password` -h `remote-db-host` --column-statistics=0 `database-name` \u003e `local/path/to/save.sql`\\n```\\n\\n#### 덤프 시도 중 `...unknown variable \'column-statistics=0\'...` 라는 에러가 발생할 경우\\n\\n- 이 에러는 해당 옵션이 불필요한 경우 발생할 수 있다. 이런 경우에는 덤프 명령어에서 `--column-statistics=0`을 제거하고 다시 시도한다.\\n\\n## .sql파일을 로컬 mysql에 로드하기\\n\\n- 덤프한 .sql 파일을 로컬 데이터베이스에 로드할 때는 mysql 명령어를 사용한다.\\n- 데이터를 받을 데이터베이스는 미리 생성되어 있고 비어 있어야 한다.\\n\\n```shell\\n$ mysql -u`local-user-name` -p`local-pwd` `database-name` \u003c `path/for/dumped.sql`\\n```\\n\\n### NO_AUTO_CREATE_USER\\n\\n#### 로드 시도 중 `Variable \'sql_mode\' can\'t be set to the value of \'NO_AUTO_CREATE_USER\'` 라는 에러가 발생할 경우\\n\\n- 이 에러는 MySQL 8.0 이상 버전에서 발생하는데, 해당 모드는 사용자 생성 관련 모드다. MySQL 8.0 이상에서는 이 모드가 제거되었으며, 대신 `CREATE USER` 또는 `GRANT` 구문을 사용한다.\\n- 이 문제를 해결하려면 `dumped.sql` 파일을 수정해야 한다.\\n- .sql 파일은 매우 크기 때문에 일반 텍스트 에디터로 수정하는 것은 비효율적이다. 대신 `sed` 명령어를 사용해 빠르게 수정할 수 있다.\\n- `macOS`와 같은 `Unix` 계열 시스템에서는 다음과 같이 `sed` 명령어를 사용한다.\\n\\n```shell\\nsed -i \'\' \'s/NO_AUTO_CREATE_USER//\' `path/for/dumped.sql`\\n```\\n\\n- 수정한 후 다시 데이터를 로드하면 된다.\\n"},"meta":{"title":"AWS RDS의 Data base를 dump하기","description":"VPC 내부에 있는 RDS에서 데이터베이스를 덤프하고, 이를 로컬 MySQL로 복구하는 과정에서 겪은 문제들을 기록한다.","date":"2021/09/14","tags":["COLUMN_STATISTICS","NO_AUTO_CREATE_USER","column-statistics=0","mysqldump","sed","sql_mode","ssh tunneling"],"thumbnail":"assets/images/posts/rds-dump.png"},"content":"\u003ch2 id=\\"ssh-tunneling을-통해-db-dump해오기\\" class=\\"heading\\"\u003essh tunneling을 통해 DB dump해오기\u003c/h2\u003e\\n\u003cul\u003e\\n\u003cli\u003emysqldump 명령어를 사용하여 .sql 파일 형태로 데이터베이스를 덤프할 수 있다.\u003c/li\u003e\\n\u003cli\u003e이 과정에서는 터널링을 수행할 EC2 인스턴스에 MySQL 클라이언트가 설치되어 있어야 한다.\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003cpre class=\\"language-shell\\"\u003e\u003ccode class=\\"language-shell code-highlight\\"\u003e\u003cspan class=\\"code-line\\"\u003e$ \u003cspan class=\\"token function\\"\u003essh\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003etunneling-instanse-username\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e@\u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003etunneling-instanse-host\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token parameter variable\\"\u003e-i\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003ekey-file-path\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e mysqldump -u\u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003eusername\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e -p\u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003epassword\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token parameter variable\\"\u003e-h\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003eremote-db-host\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003edatabase-name\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token operator\\"\u003e\u003e\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003elocal/path/to/save.sql\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003ch3 id=\\"column_statistics\\"\u003eCOLUMN_STATISTICS\u003c/h3\u003e\\n\u003ch4 id=\\"덤프-시도-중--unknown-table-column_statistics-in-information_schema-라는-에러가-발생할-경우\\"\u003e덤프 시도 중 \u003ccode\u003e...: Unknown table \'COLUMN_STATISTICS\' in information_schema\u003c/code\u003e 라는 에러가 발생할 경우\u003c/h4\u003e\\n\u003cul\u003e\\n\u003cli\u003e이 에러는 MySQL 8.0에서 새로 추가된 옵션인 COLUMN_STATISTICS 때문이다. 이 옵션은 테이블의 통계 데이터를 분석하여 덤프 시 포함하는 기능이다. \u003csup\u003e\u003ca href=\\"https://jay-ji.tistory.com/62\\" target=\\"_blank\\" rel=\\"noopener noreferer\\"\u003e레퍼런스\u003c/a\u003e\u003c/sup\u003e\u003c/li\u003e\\n\u003cli\u003e이 옵션을 비활성화하려면 덤프 명령어에 \u003ccode\u003e--column-statistics=0\u003c/code\u003e을 추가한다.\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003cpre class=\\"language-shell\\"\u003e\u003ccode class=\\"language-shell code-highlight\\"\u003e\u003cspan class=\\"code-line\\"\u003e$ \u003cspan class=\\"token function\\"\u003essh\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003etunneling-instanse-username\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e@\u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003etunneling-instanse-host\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token parameter variable\\"\u003e-i\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003ekey-file-path\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e mysqldump -u\u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003eusername\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e -p\u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003epassword\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token parameter variable\\"\u003e-h\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003eremote-db-host\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e --column-statistics\u003cspan class=\\"token operator\\"\u003e=\u003c/span\u003e\u003cspan class=\\"token number\\"\u003e0\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003edatabase-name\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token operator\\"\u003e\u003e\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003elocal/path/to/save.sql\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003ch4 id=\\"덤프-시도-중-unknown-variable-column-statistics0-라는-에러가-발생할-경우\\"\u003e덤프 시도 중 \u003ccode\u003e...unknown variable \'column-statistics=0\'...\u003c/code\u003e 라는 에러가 발생할 경우\u003c/h4\u003e\\n\u003cul\u003e\\n\u003cli\u003e이 에러는 해당 옵션이 불필요한 경우 발생할 수 있다. 이런 경우에는 덤프 명령어에서 \u003ccode\u003e--column-statistics=0\u003c/code\u003e을 제거하고 다시 시도한다.\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003ch2 id=\\"sql파일을-로컬-mysql에-로드하기\\" class=\\"heading\\"\u003e.sql파일을 로컬 mysql에 로드하기\u003c/h2\u003e\\n\u003cul\u003e\\n\u003cli\u003e덤프한 .sql 파일을 로컬 데이터베이스에 로드할 때는 mysql 명령어를 사용한다.\u003c/li\u003e\\n\u003cli\u003e데이터를 받을 데이터베이스는 미리 생성되어 있고 비어 있어야 한다.\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003cpre class=\\"language-shell\\"\u003e\u003ccode class=\\"language-shell code-highlight\\"\u003e\u003cspan class=\\"code-line\\"\u003e$ mysql -u\u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003elocal-user-name\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e -p\u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003elocal-pwd\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003edatabase-name\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\\"token operator\\"\u003e\u0026#x3C;\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003epath/for/dumped.sql\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003ch3 id=\\"no_auto_create_user\\"\u003eNO_AUTO_CREATE_USER\u003c/h3\u003e\\n\u003ch4 id=\\"로드-시도-중-variable-sql_mode-cant-be-set-to-the-value-of-no_auto_create_user-라는-에러가-발생할-경우\\"\u003e로드 시도 중 \u003ccode\u003eVariable \'sql_mode\' can\'t be set to the value of \'NO_AUTO_CREATE_USER\'\u003c/code\u003e 라는 에러가 발생할 경우\u003c/h4\u003e\\n\u003cul\u003e\\n\u003cli\u003e이 에러는 MySQL 8.0 이상 버전에서 발생하는데, 해당 모드는 사용자 생성 관련 모드다. MySQL 8.0 이상에서는 이 모드가 제거되었으며, 대신 \u003ccode\u003eCREATE USER\u003c/code\u003e 또는 \u003ccode\u003eGRANT\u003c/code\u003e 구문을 사용한다.\u003c/li\u003e\\n\u003cli\u003e이 문제를 해결하려면 \u003ccode\u003edumped.sql\u003c/code\u003e 파일을 수정해야 한다.\u003c/li\u003e\\n\u003cli\u003e.sql 파일은 매우 크기 때문에 일반 텍스트 에디터로 수정하는 것은 비효율적이다. 대신 \u003ccode\u003esed\u003c/code\u003e 명령어를 사용해 빠르게 수정할 수 있다.\u003c/li\u003e\\n\u003cli\u003e\u003ccode\u003emacOS\u003c/code\u003e와 같은 \u003ccode\u003eUnix\u003c/code\u003e 계열 시스템에서는 다음과 같이 \u003ccode\u003esed\u003c/code\u003e 명령어를 사용한다.\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003cpre class=\\"language-shell\\"\u003e\u003ccode class=\\"language-shell code-highlight\\"\u003e\u003cspan class=\\"code-line\\"\u003e\u003cspan class=\\"token function\\"\u003esed\u003c/span\u003e \u003cspan class=\\"token parameter variable\\"\u003e-i\u003c/span\u003e \u003cspan class=\\"token string\\"\u003e\'\'\u003c/span\u003e \u003cspan class=\\"token string\\"\u003e\'s/NO_AUTO_CREATE_USER//\'\u003c/span\u003e \u003cspan class=\\"token variable\\"\u003e\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003epath/for/dumped.sql\u003cspan class=\\"token variable\\"\u003e`\u003c/span\u003e\u003c/span\u003e\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003cul\u003e\\n\u003cli\u003e수정한 후 다시 데이터를 로드하면 된다.\u003c/li\u003e\\n\u003c/ul\u003e"}]]\n',
      ]);
    </script>
    <script>
      self.__next_f.push([
        1,
        '8:[[["$","meta",null,{"charSet":"utf-8"}],null,null,null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,null]\n5:[[["$","meta",null,{"charSet":"utf-8"}],null,null,null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,nu',
      ]);
    </script>
    <script>
      self.__next_f.push([
        1,
        'll,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]\n',
      ]);
    </script>
  </body>
</html>
